<!doctype html>
<html lang="en" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Explore Portugal Experience</title>

  <meta name="description" content="Explore Portugal Experience — Premium private tours & transfers." />

  <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
  <link rel="icon" href="/assets/icons/apple-touch-icon.png">

  <!-- cache bust -->
  <link rel="stylesheet" href="/assets/css/style.css?v=1001" />
</head>

<body class="home">

  <!-- HEADER (inject nav.js like FAQ) -->
  <div id="siteHeader"></div>

  <main class="page">

    <!-- WHY US -->
    <section class="section">
      <div class="wrap">
        <div class="panel">
          <h1 class="h1">Why choose Explore Portugal Experience</h1>
          <p class="p">
            Because travellers deserve calm, clarity and respect for their time. Every journey is prepared
            with genuine attention to people — not just kilometres.
          </p>

          <div class="grid-3" style="margin-top:14px;">
            <div class="card">
              <div class="label">Calm</div>
              <p class="p" style="margin-top:6px;">Discreet, unhurried.</p>
              <p class="p">Your pace, your space — always.</p>
            </div>

            <div class="card">
              <div class="label">Clarity</div>
              <p class="p" style="margin-top:6px;">No surprises.</p>
              <p class="p">Plan and price confirmed before the day.</p>
            </div>

            <div class="card">
              <div class="label">Care</div>
              <p class="p" style="margin-top:6px;">Details matter.</p>
              <p class="p">Prepared routes, timing margins, smooth execution.</p>
            </div>
          </div>

          <div class="actions" style="margin-top:16px;">
            <a class="btn btn-gold" href="/booking.html">Book / Request a quote</a>
            <a class="btn btn-ghost" href="https://www.instagram.com/exploreportugal2025" target="_blank" rel="noopener">See Instagram</a>
          </div>

          <p class="micro" style="margin-top:12px;">
            VIP response time • Professional drivers • Premium vehicles • Discreet service
          </p>
        </div>
      </div>
    </section>

    <!-- REVIEWS (PUBLIC) + FORM -->
    <section class="section" id="reviews">
      <div class="wrap">
        <div class="panel">
          <h2 class="h2">Reviews</h2>
          <p class="p">
            Real feedback from travellers. Thank you for supporting Explore Portugal Experience.
          </p>

          <div class="grid-3" style="margin-top:12px;">
            <!-- LIST -->
            <div class="card" style="grid-column: span 2;">
              <div class="label">Recent reviews</div>

              <div class="actions" style="margin-top:10px;">
                <button class="btn btn-ghost" type="button" id="epeRefreshBtn">Refresh</button>
                <a class="btn btn-ghost" href="https://g.page/r/CUhLGcsClbSWEBM/review" target="_blank" rel="noopener">Google Reviews</a>
              </div>

              <div id="epeReviewsList" style="margin-top:12px;"></div>
              <p class="micro" id="epeEmpty" style="display:none; margin-top:10px;">No reviews yet. Be the first.</p>
            </div>

            <!-- FORM -->
            <div class="card">
              <div class="label">Leave a review</div>

              <div class="epe-stars" style="margin-top:10px;">
                <button type="button" class="epe-star" data-star="1" aria-label="1 star">★</button>
                <button type="button" class="epe-star" data-star="2" aria-label="2 stars">★</button>
                <button type="button" class="epe-star" data-star="3" aria-label="3 stars">★</button>
                <button type="button" class="epe-star" data-star="4" aria-label="4 stars">★</button>
                <button type="button" class="epe-star" data-star="5" aria-label="5 stars">★</button>
                <span class="micro" id="epeRatingText" style="margin-left:8px;">Select a rating</span>
              </div>

              <div class="field" style="margin-top:12px;">
                <label class="label" for="epeReviewName">Name (optional)</label>
                <input id="epeReviewName" class="epe-input" type="text" maxlength="40" placeholder="Your name">
              </div>

              <div class="field" style="margin-top:12px;">
                <label class="label" for="epeReviewText">Review</label>
                <textarea id="epeReviewText" class="epe-input" rows="6" maxlength="800" placeholder="What did you like most?"></textarea>
                <div class="micro" id="epeCharHint" style="margin-top:6px;">0 / 800</div>
              </div>

              <div class="actions" style="margin-top:14px;">
                <button class="btn btn-gold" type="button" id="epeSubmitBtn">Post review</button>
              </div>

              <p class="micro" id="epeStatus" style="margin-top:10px;"></p>
            </div>
          </div>

        </div>
      </div>
    </section>

    <button class="to-top" type="button" aria-label="Back to top">↑</button>
  </main>

  <!-- FOOTER (inject nav.js like FAQ) -->
  <div id="siteFooter"></div>

  <!-- cache bust (bump if Android caches) -->
  <script defer src="/assets/js/nav.js?v=1003"></script>

  <script>
    (function () {
      const btn = document.querySelector('.to-top');
      if (!btn) return;
      const toggle = () => btn.classList.toggle('show', window.scrollY > 500);
      window.addEventListener('scroll', toggle, { passive: true });
      toggle();
      btn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    })();
  </script>

  <script>
    (function(){
      const API_LIST = "/api/reviews.php?action=list";
      const API_ADD  = "/api/reviews.php?action=add";

      const listEl = document.getElementById("epeReviewsList");
      const emptyEl = document.getElementById("epeEmpty");
      const refreshBtn = document.getElementById("epeRefreshBtn");

      const starBtns = Array.from(document.querySelectorAll(".epe-star"));
      const ratingText = document.getElementById("epeRatingText");
      const nameEl = document.getElementById("epeReviewName");
      const textEl = document.getElementById("epeReviewText");
      const charHint = document.getElementById("epeCharHint");
      const submitBtn = document.getElementById("epeSubmitBtn");
      const statusEl = document.getElementById("epeStatus");

      let rating = 0;

      function escapeHtml(s){
        return String(s).replace(/[&<>"']/g, c => ({
          "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
        }[c]));
      }

      function starsString(n){
        const r = Math.max(0, Math.min(5, n|0));
        return "★".repeat(r) + "☆".repeat(5-r);
      }

      function formatDate(iso){
        try{
          const d = new Date(iso);
          return d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
        }catch{ return ""; }
      }

      function setStatus(msg){ statusEl.textContent = msg || ""; }

      function setRating(n){
        rating = n;
        starBtns.forEach(btn => {
          const s = parseInt(btn.getAttribute("data-star"), 10);
          btn.classList.toggle("is-on", s <= rating);
        });
        ratingText.textContent = rating ? (rating + " / 5") : "Select a rating";
      }

      function updateChars(){
        const len = (textEl.value || "").length;
        charHint.textContent = len + " / 800";
      }

      starBtns.forEach(btn => btn.addEventListener("click", () => setRating(parseInt(btn.getAttribute("data-star"), 10))));
      textEl.addEventListener("input", updateChars);
      updateChars();

      async function loadReviews(){
        setStatus("");
        listEl.innerHTML = "";
        emptyEl.style.display = "none";

        try{
          const res = await fetch(API_LIST, { cache: "no-store" });
          const data = await res.json();
          if (!data.ok) throw new Error(data.error || "Failed");

          const reviews = Array.isArray(data.reviews) ? data.reviews : [];
          if (!reviews.length){
            emptyEl.style.display = "";
            return;
          }

          const html = reviews.map(r => {
            const name = escapeHtml(r.name || "Anonymous");
            const date = escapeHtml(formatDate(r.createdAt || ""));
            const stars = starsString(Number(r.rating || 0));
            const msg = escapeHtml(r.message || "");
            return `
              <article class="card" style="margin-bottom:10px;">
                <div class="label">${name}${date ? " · " + date : ""}</div>
                <p class="p" style="margin-top:8px;">${stars}</p>
                <p class="p">${msg}</p>
              </article>
            `;
          }).join("");

          listEl.innerHTML = html;

        }catch(err){
          // ✅ VIP: silent fail (no ugly technical message)
          emptyEl.style.display = "";
        }
      }

      async function submitReview(){
        setStatus("");

        const name = (nameEl.value || "").trim();
        const message = (textEl.value || "").trim();

        if (!rating){ setStatus("Please select a rating."); return; }
        if (!message){ setStatus("Please write a short review."); return; }

        submitBtn.disabled = true;
        submitBtn.textContent = "Posting…";

        try{
          const res = await fetch(API_ADD, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, rating, message })
          });

          const data = await res.json();
          if (!data.ok) throw new Error(data.error || "Failed");

          nameEl.value = "";
          textEl.value = "";
          updateChars();
          setRating(0);

          setStatus("Posted ✅ Thank you!");
          await loadReviews();

        }catch(err){
          // VIP: short, non-technical
          setStatus("Could not post. Please try again.");
        }finally{
          submitBtn.disabled = false;
          submitBtn.textContent = "Post review";
        }
      }

      refreshBtn.addEventListener("click", loadReviews);
      submitBtn.addEventListener("click", submitReview);

      loadReviews();
    })();
  </script>

  <!-- VIP: brighter stars + same input style, scoped only to this page -->
  <style>
    .epe-stars{display:flex;gap:6px;align-items:center;flex-wrap:wrap}

    /* default stars (not selected) — visible, not "dead" */
    .epe-star{
      width:40px;height:40px;border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
      cursor:pointer;
      display:grid;place-items:center;

      font-size:20px;
      color:rgba(255,255,255,.88);
      text-shadow:0 0 10px rgba(0,0,0,.35);

      transition:transform .08s ease, border-color .15s ease, background .15s ease, color .15s ease;
    }

    .epe-star:hover{
      transform:translateY(-1px);
      border-color:rgba(212,175,55,.45);
      background:rgba(212,175,55,.10);
      color:rgba(255,255,255,.96);
    }

    /* selected stars */
    .epe-star.is-on{
      color:rgba(212,175,55,.98);
      border-color:rgba(212,175,55,.65);
      background:rgba(212,175,55,.14);
      text-shadow:0 0 14px rgba(212,175,55,.25);
    }

    .epe-input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.92);
      outline:none;
      font: inherit;
      box-sizing: border-box;
    }

    .epe-input:focus{
      border-color:rgba(212,175,55,.42);
      box-shadow:0 0 0 6px rgba(212,175,55,.10);
    }
  </style>
</body>
</html>
